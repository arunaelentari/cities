#!/bin/bash
set -euo pipefail

echo "I will compile the cities source coude"
go build

echo "Whasaaap! I will run the test"
go test

echo "Yo, I am generating cities.env file, man"
rm -f cities.env
echo "CITIES_ISPROD=true" >> cities.env
echo "CITIES_VERSION=$(./last_commit)" >> cities.env

echo "Stopping ye olde server"
sudo systemctl stop cities

echo "Whasap, moving files to target directory"
sudo cp -r cities cities.env html /etc/cities/

echo "Hurray, restarting the server!"
sudo systemctl restart cities


